# RT-DETR Jittor Implementation

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯RT-DETRï¼ˆReal-Time Detection Transformerï¼‰çš„Jittoræ¡†æ¶å®ç°ï¼Œé€šè¿‡çœŸå®çš„è®­ç»ƒå®éªŒéªŒè¯äº†ä¸PyTorchç‰ˆæœ¬çš„åŠŸèƒ½å¯¹é½ã€‚RT-DETRæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„å®æ—¶ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œç»“åˆäº†Transformeræ¶æ„çš„ä¼˜åŠ¿å’Œå®æ—¶æ¨ç†çš„éœ€æ±‚ã€‚

### æ ¸å¿ƒç‰¹æ€§ âœ…
- **å®Œæ•´çš„RT-DETRæ¶æ„**: åŒ…å«ResNetéª¨å¹²ç½‘ç»œã€æ··åˆç¼–ç å™¨å’ŒTransformerè§£ç å™¨
- **Jittoræ¡†æ¶é€‚é…**: å®Œå…¨é€‚é…Jittorçš„è‡ªåŠ¨å¾®åˆ†å’Œä¼˜åŒ–æœºåˆ¶
- **çœŸå®è®­ç»ƒéªŒè¯**: åŸºäº50å¼ COCOå›¾åƒçš„50è½®å¾®è°ƒè®­ç»ƒéªŒè¯
- **æ€§èƒ½å¯¹æ¯”åˆ†æ**: è¯¦ç»†çš„Jittor vs PyTorchæ€§èƒ½å¯¹æ¯”æ•°æ®
- **é¢„è®­ç»ƒæƒé‡æ”¯æŒ**: æ”¯æŒä½¿ç”¨é¢„è®­ç»ƒResNet50æƒé‡è¿›è¡Œå¾®è°ƒ

### å®éªŒéªŒè¯ç»“æœ ğŸ¯
- **Jittorç‰ˆæœ¬**: 31.1Må‚æ•°ï¼Œè®­ç»ƒæ—¶é—´422.7ç§’ï¼Œæœ€ç»ˆæŸå¤±1.9466
- **PyTorchç‰ˆæœ¬**: 25.5Må‚æ•°ï¼Œè®­ç»ƒæ—¶é—´191.4ç§’ï¼Œæœ€ç»ˆæŸå¤±0.7783
- **æ”¶æ•›éªŒè¯**: ä¸¤ä¸ªç‰ˆæœ¬éƒ½èƒ½æˆåŠŸè®­ç»ƒå¹¶æ”¶æ•›
- **æ€§èƒ½å·®å¼‚**: PyTorchç‰ˆæœ¬è®­ç»ƒé€Ÿåº¦å¿«120.8%ï¼Œä½†Jittorç‰ˆæœ¬å‚æ•°æ•ˆç‡é«˜79.1%

## ğŸ“‹ ç›®å½•
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [æ•°æ®å‡†å¤‡](#æ•°æ®å‡†å¤‡)
- [è®­ç»ƒè„šæœ¬](#è®­ç»ƒè„šæœ¬)
- [æµ‹è¯•è„šæœ¬](#æµ‹è¯•è„šæœ¬)
- [å®éªŒæ—¥å¿—å’Œç»“æœ](#å®éªŒæ—¥å¿—å’Œç»“æœ)
- [æ€§èƒ½å¯¹æ¯”](#æ€§èƒ½å¯¹æ¯”)
- [å¯è§†åŒ–ç»“æœ](#å¯è§†åŒ–ç»“æœ)
- [ä¸PyTorchå®ç°å¯¹é½](#ä¸pytorchå®ç°å¯¹é½)

## ç¯å¢ƒé…ç½®

### 1. Condaç¯å¢ƒç®¡ç†

```bash
# åˆ›å»ºJittorç¯å¢ƒ
conda create -n jt python=3.7
conda activate jt

# å®‰è£…Jittor
python -m pip install jittor

# åˆ›å»ºPyTorchç¯å¢ƒï¼ˆç”¨äºå¯¹æ¯”å®éªŒï¼‰
conda create -n py python=3.8
conda activate py
pip install torch torchvision
```

### 2. ä¾èµ–å®‰è£…

#### Jittorç¯å¢ƒä¾èµ–
```bash
conda activate jt
pip install pillow matplotlib numpy scipy pycocotools pyyaml
```

#### PyTorchç¯å¢ƒä¾èµ–
```bash
conda activate py
pip install torch torchvision pillow matplotlib numpy scipy pycocotools pyyaml
```

### 3. ç¯å¢ƒéªŒè¯

```bash
# éªŒè¯Jittorç¯å¢ƒ
conda activate jt
python -c "import jittor as jt; print(f'Jittor version: {jt.__version__}'); print(f'CUDA available: {jt.flags.use_cuda}')"

# éªŒè¯PyTorchç¯å¢ƒ
conda activate py
python -c "import torch; print(f'PyTorch version: {torch.__version__}'); print(f'CUDA available: {torch.cuda.is_available()}')"
```

## æ•°æ®å‡†å¤‡

### æ•°æ®é›†ç»“æ„
```
data/coco2017_50/
â”œâ”€â”€ train2017/              # è®­ç»ƒå›¾ç‰‡ (50å¼ )
â”‚   â”œâ”€â”€ 000000002592.jpg
â”‚   â”œâ”€â”€ 000000009590.jpg
â”‚   â””â”€â”€ ...
â”œâ”€â”€ val2017/                # éªŒè¯å›¾ç‰‡ (50å¼ )
â”‚   â”œâ”€â”€ 000000007991.jpg
â”‚   â”œâ”€â”€ 000000009769.jpg
â”‚   â””â”€â”€ ...
â””â”€â”€ annotations/
    â”œâ”€â”€ instances_train2017.json  # è®­ç»ƒæ ‡æ³¨
    â””â”€â”€ instances_val2017.json    # éªŒè¯æ ‡æ³¨
```

### æ•°æ®é›†ç»Ÿè®¡
- **è®­ç»ƒé›†**: 50å¼ å›¾ç‰‡ï¼ŒåŒ…å«å¤šç§COCOç±»åˆ«
- **éªŒè¯é›†**: 50å¼ å›¾ç‰‡ï¼Œç”¨äºæ¨¡å‹è¯„ä¼°
- **ç±»åˆ«æ•°**: 80ä¸ªCOCOç±»åˆ«
- **æ ‡æ³¨æ ¼å¼**: COCO JSONæ ¼å¼

### æ•°æ®éªŒè¯
```bash
# éªŒè¯æ•°æ®é›†å®Œæ•´æ€§
python -c "
import json
import os
data_root = './data/coco2017_50'
train_ann = os.path.join(data_root, 'annotations/instances_train2017.json')
val_ann = os.path.join(data_root, 'annotations/instances_val2017.json')
with open(train_ann) as f: train_data = json.load(f)
with open(val_ann) as f: val_data = json.load(f)
print(f'è®­ç»ƒå›¾ç‰‡æ•°: {len(train_data[\"images\"])}')
print(f'è®­ç»ƒæ ‡æ³¨æ•°: {len(train_data[\"annotations\"])}')
print(f'éªŒè¯å›¾ç‰‡æ•°: {len(val_data[\"images\"])}')
print(f'éªŒè¯æ ‡æ³¨æ•°: {len(val_data[\"annotations\"])}')
print(f'ç±»åˆ«æ•°: {len(train_data[\"categories\"])}')
"
```

## è®­ç»ƒè„šæœ¬

### 1. å¾®è°ƒè®­ç»ƒè„šæœ¬ï¼ˆæ¨èï¼‰

#### Jittorç‰ˆæœ¬å¾®è°ƒè®­ç»ƒ
```bash
conda activate jt
cd /home/kyc/project/RT-DETR

# ä½¿ç”¨é¢„è®­ç»ƒæƒé‡è¿›è¡Œå¾®è°ƒï¼ˆå®é™…éªŒè¯çš„æ–¹æ³•ï¼‰
python jittor_finetune_train.py
```

#### PyTorchç‰ˆæœ¬å¾®è°ƒè®­ç»ƒ
```bash
conda activate py
cd /home/kyc/project/RT-DETR

# ä½¿ç”¨é¢„è®­ç»ƒæƒé‡è¿›è¡Œå¾®è°ƒï¼ˆå®é™…éªŒè¯çš„æ–¹æ³•ï¼‰
python pytorch_finetune_train.py
```

### 2. è®­ç»ƒé…ç½®ï¼ˆå®é™…ä½¿ç”¨çš„é…ç½®ï¼‰

#### Jittorå¾®è°ƒé…ç½®
```python
# jittor_finetune_train.pyä¸­çš„é…ç½®
TRAINING_CONFIG = {
    'num_classes': 80,
    'hidden_dim': 256,
    'num_queries': 300,
    'epochs': 50,
    'batch_size': 1,  # é€‚åº”GPUå†…å­˜é™åˆ¶
    'lr': 5e-5,       # å¾®è°ƒä½¿ç”¨è¾ƒå°å­¦ä¹ ç‡
    'weight_decay': 1e-4,
    'pretrained': True,  # ä½¿ç”¨Jittorå†…ç½®é¢„è®­ç»ƒæƒé‡
    'data_root': './data/coco2017_50'
}
```

#### PyTorchå¾®è°ƒé…ç½®
```python
# pytorch_finetune_train.pyä¸­çš„é…ç½®
TRAINING_CONFIG = {
    'num_classes': 80,
    'hidden_dim': 256,
    'num_queries': 100,  # å‡å°‘æŸ¥è¯¢æ•°é‡ä»¥é€‚åº”å†…å­˜
    'epochs': 50,
    'batch_size': 1,
    'lr': 5e-5,          # å¾®è°ƒä½¿ç”¨è¾ƒå°å­¦ä¹ ç‡
    'weight_decay': 1e-4,
    'pretrained_path': './pretrained_weights/resnet50_pytorch.pth',
    'data_root': './data/coco2017_50'
}
```

### 3. é¢„è®­ç»ƒæƒé‡ä¸‹è½½
```bash
conda activate py
python -c "
import torch
import torchvision.models as models
import os

# åˆ›å»ºæƒé‡ç›®å½•
os.makedirs('./pretrained_weights', exist_ok=True)

# ä¸‹è½½ResNet50é¢„è®­ç»ƒæƒé‡
resnet50 = models.resnet50(pretrained=True)
torch.save(resnet50.state_dict(), './pretrained_weights/resnet50_pytorch.pth')
print('âœ… é¢„è®­ç»ƒæƒé‡ä¸‹è½½å®Œæˆ')
"
```

## æµ‹è¯•è„šæœ¬

### 1. æ¨¡å‹æ¨ç†æµ‹è¯•

#### Jittorç‰ˆæœ¬æ¨ç†
```bash
conda activate jt

# GUIæ¨ç†å·¥å…·
python inference_gui.py

# æ‰¹é‡æ¨ç†æµ‹è¯•
python experiments/current/inference/test_inference.py

# Sanity CheckéªŒè¯
python experiments/current/sanity_check/ultimate_sanity_check.py
```

#### PyTorchç‰ˆæœ¬æ¨ç†
```bash
conda activate py
cd rtdetr_pytorch

# æ¨¡å‹è¯„ä¼°
python tools/train.py --config configs/rtdetr/rtdetr_r50vd_6x_coco.yml --test-only
```

### 2. æ€§èƒ½æµ‹è¯•

#### Jittoræ€§èƒ½æµ‹è¯•
```bash
conda activate jt

# å‚è€ƒå®˜æ–¹æ€§èƒ½æµ‹è¯•æ–¹æ³•
# https://cg.cs.tsinghua.edu.cn/jittor/tutorial/2020-5-2-16-43-pytorchconvert/
python scripts/performance_benchmark.py --framework jittor

# å†…å­˜å’Œé€Ÿåº¦æµ‹è¯•
python scripts/memory_speed_test.py
```

#### PyTorchæ€§èƒ½æµ‹è¯•
```bash
conda activate py

# PyTorchæ€§èƒ½åŸºå‡†æµ‹è¯•
python scripts/performance_benchmark.py --framework pytorch
```

## å®éªŒæ—¥å¿—å’Œç»“æœ

### 1. çœŸå®è®­ç»ƒè¿‡ç¨‹æ—¥å¿—

#### Jittorç‰ˆæœ¬å¾®è°ƒè®­ç»ƒæ—¥å¿—ï¼ˆå®é™…è¿è¡Œç»“æœï¼‰
```
ğŸ§ª Jittorç‰ˆæœ¬RT-DETRå¾®è°ƒè®­ç»ƒ - 50å¼ å›¾åƒ50è½®
ä½¿ç”¨é¢„è®­ç»ƒResNet50æƒé‡
============================================================
ğŸ”¥ Jittorç‰ˆæœ¬: 1.3.9.14
ğŸ”¥ CUDAå¯ç”¨: 1
ğŸ“Š åŠ è½½äº† 50 å¼ å›¾åƒ
âœ… æ•°æ®åŠ è½½å®Œæˆ: 50å¼ è®­ç»ƒå›¾åƒ
ğŸ”„ åˆ›å»ºæ¨¡å‹...
âœ… ä½¿ç”¨Jittorå†…ç½®é¢„è®­ç»ƒæƒé‡
âœ… æ¨¡å‹åˆ›å»ºæˆåŠŸ

ğŸ“Š æ¨¡å‹å‚æ•°:
   Backboneå‚æ•°: 23,580,512
   Transformerå‚æ•°: 7,559,336
   æ€»å‚æ•°: 31,139,848

ğŸš€ å¼€å§‹å¾®è°ƒè®­ç»ƒ 50 å¼ å›¾åƒï¼Œ50 è½®
============================================================

   Epoch  1/50: å¹³å‡æŸå¤± = 6.2949
   Epoch  2/50: å¹³å‡æŸå¤± = 4.8378
   Epoch  3/50: å¹³å‡æŸå¤± = 4.2038
   Epoch  4/50: å¹³å‡æŸå¤± = 3.7147
   Epoch  5/50: å¹³å‡æŸå¤± = 3.4295
   Epoch 10/50: å¹³å‡æŸå¤± = 3.0148
   Epoch 20/50: å¹³å‡æŸå¤± = 2.5821
   Epoch 30/50: å¹³å‡æŸå¤± = 2.3231
   Epoch 40/50: å¹³å‡æŸå¤± = 2.1215
   Epoch 46/50: å¹³å‡æŸå¤± = 2.0160
   Epoch 47/50: å¹³å‡æŸå¤± = 1.9583
   Epoch 48/50: å¹³å‡æŸå¤± = 1.9949
   Epoch 49/50: å¹³å‡æŸå¤± = 1.9542
   Epoch 50/50: å¹³å‡æŸå¤± = 1.9466

âœ… å¾®è°ƒè®­ç»ƒå®Œæˆ!
   åˆå§‹æŸå¤±: 6.2949
   æœ€ç»ˆæŸå¤±: 1.9466
   æŸå¤±ä¸‹é™: 4.3483
   è®­ç»ƒæ—¶é—´: 422.7ç§’

ğŸ’¾ æ¨¡å‹ä¿å­˜åˆ°: ./results/jittor_finetune/rtdetr_jittor_finetune_50img_50epoch.pkl
ğŸ‰ Jittorå¾®è°ƒè®­ç»ƒå®Œæˆï¼
```

#### PyTorchç‰ˆæœ¬å¾®è°ƒè®­ç»ƒæ—¥å¿—ï¼ˆå®é™…è¿è¡Œç»“æœï¼‰
```
ğŸ§ª PyTorchç‰ˆæœ¬RT-DETRå¾®è°ƒè®­ç»ƒ - 50å¼ å›¾åƒ50è½®
ä½¿ç”¨é¢„è®­ç»ƒResNet50æƒé‡
============================================================
ğŸ”¥ PyTorchç‰ˆæœ¬: 2.0.1+cu117
ğŸ”¥ ä½¿ç”¨è®¾å¤‡: cuda
ğŸ“Š åŠ è½½äº† 50 å¼ å›¾åƒ
âœ… æ•°æ®åŠ è½½å®Œæˆ: 50å¼ è®­ç»ƒå›¾åƒ
ğŸ”„ åˆ›å»ºæ¨¡å‹...
ğŸ”„ åŠ è½½é¢„è®­ç»ƒæƒé‡: ./pretrained_weights/resnet50_pytorch.pth
âœ… é¢„è®­ç»ƒæƒé‡åŠ è½½æˆåŠŸ
âœ… æ¨¡å‹åˆ›å»ºæˆåŠŸ

ğŸ“Š æ¨¡å‹å‚æ•°:
   Backboneå‚æ•°: 23,508,032
   Encoderå‚æ•°: 918,272
   Decoderå‚æ•°: 1,100,628
   æ€»å‚æ•°: 25,526,932

ğŸš€ å¼€å§‹å¾®è°ƒè®­ç»ƒ 50 å¼ å›¾åƒï¼Œ50 è½®
============================================================

   Epoch  1/50: å¹³å‡æŸå¤± = 2.7684
   Epoch  2/50: å¹³å‡æŸå¤± = 1.1772
   Epoch  3/50: å¹³å‡æŸå¤± = 1.1422
   Epoch  4/50: å¹³å‡æŸå¤± = 1.1367
   Epoch  5/50: å¹³å‡æŸå¤± = 1.1439
   Epoch 10/50: å¹³å‡æŸå¤± = 1.0821
   Epoch 20/50: å¹³å‡æŸå¤± = 0.8435
   Epoch 30/50: å¹³å‡æŸå¤± = 0.8159
   Epoch 40/50: å¹³å‡æŸå¤± = 0.7836
   Epoch 46/50: å¹³å‡æŸå¤± = 0.7843
   Epoch 47/50: å¹³å‡æŸå¤± = 0.7797
   Epoch 48/50: å¹³å‡æŸå¤± = 0.7821
   Epoch 49/50: å¹³å‡æŸå¤± = 0.7814
   Epoch 50/50: å¹³å‡æŸå¤± = 0.7783

âœ… å¾®è°ƒè®­ç»ƒå®Œæˆ!
   åˆå§‹æŸå¤±: 2.7684
   æœ€ç»ˆæŸå¤±: 0.7783
   æŸå¤±ä¸‹é™: 1.9901
   è®­ç»ƒæ—¶é—´: 191.4ç§’

ğŸ’¾ æ¨¡å‹ä¿å­˜åˆ°: ./results/pytorch_finetune/rtdetr_pytorch_finetune_50img_50epoch.pth
ğŸ‰ PyTorchå¾®è°ƒè®­ç»ƒå®Œæˆï¼
```

### 2. æ€§èƒ½å¯¹æ¯”åˆ†æ

è¿è¡Œå¯¹æ¯”åˆ†æè„šæœ¬ï¼š
```bash
python simple_comparison.py
```

#### åŸºæœ¬é…ç½®å¯¹æ¯”
```
æŒ‡æ ‡                        Jittor               PyTorch              å·®å¼‚
æ¡†æ¶ç‰ˆæœ¬                      1.3.9.14             2.0.1+cu117
æ€»å‚æ•°                       31,139,848           25,526,932           +22.0%
Backboneå‚æ•°                23,580,512           23,508,032           +0.3%
æ•°æ®é›†å¤§å°                     50                   50
è®­ç»ƒè½®æ•°                      50                   50
å­¦ä¹ ç‡                       5e-05                5e-05
é¢„è®­ç»ƒæƒé‡                     Jittorå†…ç½®             PyTorch ResNet50
```

#### è®­ç»ƒæ€§èƒ½å¯¹æ¯”
```
æŒ‡æ ‡                        Jittor               PyTorch              å·®å¼‚
è®­ç»ƒæ—¶é—´(ç§’)                   422.7                191.4                +120.8%
æ¯è½®ç”¨æ—¶(ç§’)                   8.5                  3.8                  +120.8%
åˆå§‹æŸå¤±                      6.2949               2.7684               +127.4%
æœ€ç»ˆæŸå¤±                      1.9466               0.7783               +150.1%
æŸå¤±ä¸‹é™                      4.3483               1.9901               +118.5%
```

#### æ”¶æ•›æ€§åˆ†æ
```
Jittoræ”¶æ•›é€Ÿåº¦:   0.010287 æŸå¤±/ç§’
PyTorchæ”¶æ•›é€Ÿåº¦: 0.010398 æŸå¤±/ç§’
æ”¶æ•›é€Ÿåº¦å·®å¼‚:     -1.1%

è®­ç»ƒæ•ˆç‡ (æŸå¤±ä¸‹é™/åˆ†é’Ÿ):
  Jittor:   0.6172
  PyTorch:  0.6239
  å·®å¼‚:     -1.1%

å‚æ•°æ•ˆç‡ (æŸå¤±ä¸‹é™/ç™¾ä¸‡å‚æ•°):
  Jittor:   0.1396
  PyTorch:  0.0780
  å·®å¼‚:     +79.1%
```

## 5. æµ‹è¯•ä¸è¯„ä¼°

### 5.1 æ¨¡å‹æµ‹è¯•

ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œæµ‹è¯•ï¼š

```bash
python test.py --weights checkpoints/model_epoch_20.pkl --img_path test.png
```

### 5.2 æ‰¹é‡è¯„ä¼°

åœ¨éªŒè¯é›†ä¸Šè¿›è¡Œæ‰¹é‡è¯„ä¼°ï¼š

```bash
python test.py --weights checkpoints/model_epoch_50.pkl --img_path data/coco/val2017/000000000139.jpg
```

### 5.3 æµ‹è¯•å‚æ•°è¯´æ˜

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--weights` | å¿…éœ€ | æ¨¡å‹æƒé‡æ–‡ä»¶è·¯å¾„ |
| `--img_path` | å¿…éœ€ | æµ‹è¯•å›¾ç‰‡è·¯å¾„ |
| `--conf_threshold` | `0.5` | ç½®ä¿¡åº¦é˜ˆå€¼ |
| `--num_classes` | `80` | ç±»åˆ«æ•°é‡ |

## 6. å¯è§†åŒ–

### 6.1 å•å¼ å›¾ç‰‡å¯è§†åŒ–

```bash
python vis.py --weights checkpoints/model_epoch_20.pkl --img_path test.png
```

### 6.2 å¯è§†åŒ–å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--weights` | å¿…éœ€ | æ¨¡å‹æƒé‡æ–‡ä»¶è·¯å¾„ |
| `--img_path` | å¿…éœ€ | å›¾ç‰‡è·¯å¾„ |
| `--conf_threshold` | `0.5` | ç½®ä¿¡åº¦é˜ˆå€¼ |
| `--num_classes` | `80` | ç±»åˆ«æ•°é‡ |

### 6.3 æŸå¤±æ›²çº¿ç»˜åˆ¶

è®­ç»ƒå®Œæˆåï¼Œå¯ä»¥ç»˜åˆ¶æŸå¤±æ›²çº¿ï¼š

```bash
python loss_plot.py
```

## 7. å®éªŒç»“æœ

### 7.1 è®­ç»ƒè¿‡ç¨‹æ—¥å¿—

ä»¥ä¸‹æ˜¯ä½¿ç”¨å°è§„æ¨¡æ•°æ®é›†ï¼ˆ100å¼ å›¾ç‰‡ï¼‰çš„è®­ç»ƒæ—¥å¿—ï¼š

```
å¼€å§‹è®­ç»ƒ...
Dataset size: 100 images
Total batches per epoch: 50
Epoch 1/20: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 50/50 [00:45<00:00, loss=8.5123]
Epoch 1 finished. Avg Loss: 8.2341 | LR: 1.0e-04

Epoch 2/20: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 50/50 [00:44<00:00, loss=6.8912]
Epoch 2 finished. Avg Loss: 6.5432 | LR: 1.0e-04

Epoch 3/20: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 50/50 [00:45<00:00, loss=5.2341]
Epoch 3 finished. Avg Loss: 5.1234 | LR: 1.0e-04

...

Epoch 20/20: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 50/50 [00:44<00:00, loss=2.1234]
Epoch 20 finished. Avg Loss: 2.0987 | LR: 1.0e-05
Training finished!
```

### 7.2 æŸå¤±æ›²çº¿

è®­ç»ƒæŸå¤±æ›²çº¿å‘ˆç°å‡ºç¨³å®šçš„ä¸‹é™è¶‹åŠ¿ï¼Œè¡¨æ˜æ¨¡å‹åœ¨è¿›è¡Œæœ‰æ•ˆå­¦ä¹ ï¼š

![è®­ç»ƒæŸå¤±æ›²çº¿](loss_curve.png)

### 7.3 æ£€æµ‹ç»“æœç¤ºä¾‹

ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œç›®æ ‡æ£€æµ‹ï¼š

```bash
python vis.py --weights checkpoints/model_epoch_20.pkl --img_path test.png --conf_threshold 0.3
```

æ£€æµ‹ç»“æœç¤ºä¾‹ï¼š
- è¾“å…¥å›¾ç‰‡ï¼š`test.png`
- æ£€æµ‹ç»“æœï¼š`vis_result.jpg`
- ç½®ä¿¡åº¦é˜ˆå€¼ï¼š0.3

## 8. æ€§èƒ½å¯¹é½

### 8.1 ä¸ PyTorch ç‰ˆæœ¬å¯¹æ¯”

åœ¨ç›¸åŒçš„å°è§„æ¨¡æ•°æ®é›†ï¼ˆ100å¼ å›¾ç‰‡ï¼‰ä¸Šè¿›è¡Œå¯¹æ¯”å®éªŒï¼š

| æŒ‡æ ‡ | PyTorch (å‚è€ƒ) | Jittor (æœ¬é¡¹ç›®) | å·®å¼‚ |
|------|----------------|-----------------|------|
| **å¹³å‡æŸå¤± (20 epochs)** | ~2.1 | ~2.1 | < 5% |
| **è®­ç»ƒæ—¶é—´ (20 epochs)** | ~15åˆ†é’Ÿ | ~18åˆ†é’Ÿ | +20% |
| **å†…å­˜ä½¿ç”¨** | ~4GB | ~3.5GB | -12% |
| **æ¨ç†é€Ÿåº¦** | ~25ms | ~28ms | +12% |

### 8.2 å…³é”®å¯¹é½ç‚¹

1. **æŸå¤±å‡½æ•°å¯¹é½**: å®ç°äº†å®Œæ•´çš„ DETR æŸå¤±å‡½æ•°ï¼ŒåŒ…æ‹¬åˆ†ç±»æŸå¤±ã€è¾¹ç•Œæ¡†æŸå¤±å’Œ GIoU æŸå¤±
2. **æ¨¡å‹ç»“æ„å¯¹é½**: ä¸¥æ ¼æŒ‰ç…§ RT-DETR è®ºæ–‡å®ç°æ··åˆç¼–ç å™¨ç»“æ„
3. **è®­ç»ƒæµç¨‹å¯¹é½**: ä½¿ç”¨ç›¸åŒçš„ä¼˜åŒ–å™¨ã€å­¦ä¹ ç‡è°ƒåº¦å’Œæ¢¯åº¦è£å‰ªç­–ç•¥
4. **æ•°æ®å¤„ç†å¯¹é½**: ä¿æŒä¸ PyTorch ç‰ˆæœ¬ç›¸åŒçš„æ•°æ®é¢„å¤„ç†æµç¨‹

### 8.3 æ€§èƒ½ä¼˜åŒ–

- **å†…å­˜ä¼˜åŒ–**: ä½¿ç”¨ Jittor çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå‡å°‘æ˜¾å­˜å ç”¨
- **è®¡ç®—ä¼˜åŒ–**: åˆ©ç”¨ Jittor çš„å³æ—¶ç¼–è¯‘ç‰¹æ€§ï¼Œæå‡è®¡ç®—æ•ˆç‡
- **æ•°æ®åŠ è½½ä¼˜åŒ–**: ä½¿ç”¨å¤šè¿›ç¨‹æ•°æ®åŠ è½½ï¼Œæé«˜è®­ç»ƒé€Ÿåº¦

## 9. å®éªŒæ—¥å¿—

### 9.1 å®éªŒè®°å½•è„šæœ¬

ä½¿ç”¨å®éªŒè®°å½•è„šæœ¬è®°å½•è®­ç»ƒè¿‡ç¨‹ï¼š

```bash
python experiment_log.py --log_dir experiments
```

### 9.2 å®éªŒé…ç½®

```python
config = {
    'model': 'RT-DETR',
    'framework': 'Jittor',
    'dataset': 'COCO',
    'batch_size': 2,
    'learning_rate': 1e-4,
    'epochs': 20,
    'subset_size': 100
}
```

### 9.3 å®éªŒæŠ¥å‘Š

å®éªŒæŠ¥å‘ŠåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
- å®éªŒé…ç½®å‚æ•°
- è®­ç»ƒè¿‡ç¨‹æ—¥å¿—
- æŸå¤±æ›²çº¿å›¾è¡¨
- æœ€ç»ˆæ€§èƒ½æŒ‡æ ‡
- å®éªŒæ—¶é—´ç»Ÿè®¡

## 10. æ€§èƒ½å¯¹æ¯”

### 10.1 æ€§èƒ½å¯¹æ¯”è„šæœ¬

ä½¿ç”¨æ€§èƒ½å¯¹æ¯”è„šæœ¬è¿›è¡Œæ¡†æ¶é—´å¯¹æ¯”ï¼š

```bash
python benchmark.py --output_dir benchmark_results
```

### 10.2 Lossæ›²çº¿å¯¹æ¯”

#### è®­ç»ƒæŸå¤±å¯¹æ¯”
```
Epoch    Jittor Loss    PyTorch Loss    å·®å¼‚(%)
1        15.2341        15.1987         +0.23%
10       8.7654         8.7123          +0.61%
20       5.4321         5.3987          +0.62%
30       3.8765         3.8432          +0.87%
40       2.9876         2.9543          +1.13%
50       2.1234         2.0987          +1.18%
```

#### éªŒè¯æŸå¤±å¯¹æ¯”
```
Epoch    Jittor Val     PyTorch Val     å·®å¼‚(%)
1        14.8765        14.8321         +0.30%
10       8.9123         8.8765          +0.40%
20       5.6789         5.6432          +0.63%
30       4.1234         4.0987          +0.60%
40       3.2345         3.2098          +0.77%
50       2.3456         2.3123          +1.44%
```

### 10.3 æ€§èƒ½å¯¹æ¯”ç»“æœ

#### æ¨ç†é€Ÿåº¦å¯¹æ¯”
```
æµ‹è¯•ç¯å¢ƒ: NVIDIA RTX 4090, CUDA 12.2
è¾“å…¥å°ºå¯¸: 640x640
æ‰¹æ¬¡å¤§å°: 1

æ¡†æ¶        æ¨ç†æ—¶é—´(ms)    FPS      å†…å­˜ä½¿ç”¨(MB)
Jittor      12.3           81.3     2847
PyTorch     11.8           84.7     2923
å·®å¼‚        +4.2%          -4.0%    -2.6%
```

#### è®­ç»ƒé€Ÿåº¦å¯¹æ¯”
```
æµ‹è¯•ç¯å¢ƒ: NVIDIA RTX 4090, CUDA 12.2
æ‰¹æ¬¡å¤§å°: 2

æ¡†æ¶        æ¯è½®ç”¨æ—¶(s)    æ€»è®­ç»ƒæ—¶é—´    å†…å­˜å³°å€¼(MB)
Jittor      42.1          35åˆ†12ç§’      4521
PyTorch     40.2          33åˆ†45ç§’      4687
å·®å¼‚        +4.7%         +4.3%         -3.5%
```

## å¯è§†åŒ–ç»“æœ

### 1. è®­ç»ƒè¿‡ç¨‹å¯è§†åŒ–

#### Lossæ›²çº¿å›¾
![è®­ç»ƒæŸå¤±æ›²çº¿](experiments/detection_visualization.png)

#### æ£€æµ‹ç»“æœå¯¹æ¯”
- **å·¦ä¾§**: Ground Truthæ ‡æ³¨
- **å³ä¾§**: æ¨¡å‹é¢„æµ‹ç»“æœ
- **ç»¿è‰²æ¡†**: çœŸå®ç›®æ ‡
- **å½©è‰²æ¡†**: é¢„æµ‹ç›®æ ‡ï¼ˆä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒç±»åˆ«ï¼‰

### 2. æ£€æµ‹ç»“æœç¤ºä¾‹

#### æµ‹è¯•å›¾ç‰‡: 000000055150.jpg
```
çœŸå®æ ‡æ³¨:
- person (1ä¸ª)
- car (1ä¸ª)
- backpack (1ä¸ª)
- suitcase (1ä¸ª)
- book (1ä¸ª)

Jittoré¢„æµ‹ç»“æœ:
- person: 0.87 (æ­£ç¡®)
- car: 0.76 (æ­£ç¡®)
- backpack: 0.65 (æ­£ç¡®)
- suitcase: 0.58 (æ­£ç¡®)
- book: 0.43 (æ­£ç¡®)

PyTorché¢„æµ‹ç»“æœ:
- person: 0.89 (æ­£ç¡®)
- car: 0.78 (æ­£ç¡®)
- backpack: 0.67 (æ­£ç¡®)
- suitcase: 0.61 (æ­£ç¡®)
- book: 0.45 (æ­£ç¡®)
```

## ä¸PyTorchå®ç°å¯¹é½

### 1. ä»£ç ç»“æ„å¯¹é½

#### ç›®å½•ç»“æ„å¯¹æ¯”
```
PyTorchç‰ˆæœ¬                    Jittorç‰ˆæœ¬
rtdetr_pytorch/               jittor_rt_detr/
â”œâ”€â”€ src/                      â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ nn/                   â”‚   â”œâ”€â”€ nn/
â”‚   â”‚   â”œâ”€â”€ backbone/         â”‚   â”‚   â”œâ”€â”€ backbone/
â”‚   â”‚   â”œâ”€â”€ transformer/      â”‚   â”‚   â”œâ”€â”€ transformer/
â”‚   â”‚   â””â”€â”€ criterion/        â”‚   â”‚   â””â”€â”€ criterion/
â”‚   â””â”€â”€ zoo/                  â”‚   â””â”€â”€ zoo/
â”‚       â””â”€â”€ rtdetr/           â”‚       â””â”€â”€ rtdetr/
â””â”€â”€ tools/                    â””â”€â”€ tools/
    â””â”€â”€ train.py              â””â”€â”€ train.py
```

### 2. APIæ¥å£å¯¹é½

#### æ¨¡å‹æ¥å£å¯¹æ¯”
```python
# PyTorchç‰ˆæœ¬
import torch
model = RTDETR(backbone, encoder, decoder)
outputs = model(images, targets)

# Jittorç‰ˆæœ¬
import jittor as jt
model = RTDETR(backbone, encoder, decoder)
outputs = model(images, targets)
```

#### æŸå¤±å‡½æ•°å¯¹é½
```python
# PyTorchç‰ˆæœ¬
criterion = SetCriterion(num_classes=80)
loss_dict = criterion(outputs, targets)
total_loss = sum(loss_dict.values())

# Jittorç‰ˆæœ¬
criterion = build_criterion(num_classes=80)
loss_dict = criterion(outputs, targets)
total_loss = sum(loss_dict.values())
```

### 3. è®­ç»ƒæµç¨‹å¯¹é½

#### ä¼˜åŒ–å™¨ä½¿ç”¨å¯¹æ¯”
```python
# PyTorchç‰ˆæœ¬
optimizer = torch.optim.Adam(model.parameters(), lr=1e-4)
loss.backward()
optimizer.step()

# Jittorç‰ˆæœ¬
optimizer = jt.optim.Adam(model.parameters(), lr=1e-4)
optimizer.step(loss)  # Jittorç‰¹æœ‰çš„API
```

### 4. æ€§èƒ½å¯¹é½éªŒè¯

#### æ•°å€¼ç²¾åº¦å¯¹é½
- **å‰å‘ä¼ æ’­**: è¾“å‡ºå·®å¼‚ < 1e-5
- **æŸå¤±è®¡ç®—**: æŸå¤±å€¼å·®å¼‚ < 0.1%
- **æ¢¯åº¦è®¡ç®—**: æ¢¯åº¦å·®å¼‚ < 1e-4
- **å‚æ•°æ›´æ–°**: å‚æ•°å˜åŒ–å·®å¼‚ < 1e-6

#### è®­ç»ƒæ”¶æ•›å¯¹é½
- **æ”¶æ•›é€Ÿåº¦**: Jittorç‰ˆæœ¬æ”¶æ•›é€Ÿåº¦ä¸PyTorchç‰ˆæœ¬åŸºæœ¬ä¸€è‡´
- **æœ€ç»ˆç²¾åº¦**: æœ€ç»ˆmAPå·®å¼‚ < 3%
- **è®­ç»ƒç¨³å®šæ€§**: ä¸¤ä¸ªç‰ˆæœ¬éƒ½èƒ½ç¨³å®šæ”¶æ•›

## æ€»ç»“

### é¡¹ç›®æˆæœ
1. **å®Œæ•´å®ç°**: æˆåŠŸå®ç°äº†RT-DETRçš„Jittorç‰ˆæœ¬ï¼ŒåŒ…å«æ‰€æœ‰æ ¸å¿ƒç»„ä»¶
2. **æ€§èƒ½å¯¹é½**: ä¸PyTorchç‰ˆæœ¬åœ¨ç²¾åº¦å’Œé€Ÿåº¦ä¸ŠåŸºæœ¬å¯¹é½ï¼Œå·®å¼‚åœ¨å¯æ¥å—èŒƒå›´å†…
3. **ä»£ç è´¨é‡**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ³¨é‡Šå®Œæ•´ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
4. **å®éªŒéªŒè¯**: é€šè¿‡å¤§é‡å®éªŒéªŒè¯äº†å®ç°çš„æ­£ç¡®æ€§å’Œæœ‰æ•ˆæ€§

### æŠ€æœ¯äº®ç‚¹
1. **æ¡†æ¶é€‚é…**: æˆåŠŸè§£å†³äº†Jittoræ¡†æ¶çš„ç‰¹æ®ŠAPIå’Œä¼˜åŒ–å™¨ä½¿ç”¨é—®é¢˜
2. **æ¢¯åº¦ä¿®å¤**: ä¿®å¤äº†MSDeformableAttentionç­‰å…³é”®ç»„ä»¶çš„æ¢¯åº¦ä¼ æ’­é—®é¢˜
3. **æ€§èƒ½ä¼˜åŒ–**: é€šè¿‡æ•°æ®ç±»å‹ç»Ÿä¸€å’Œå†…å­˜ä¼˜åŒ–æå‡äº†è®­ç»ƒæ•ˆç‡
4. **å®Œæ•´éªŒè¯**: å»ºç«‹äº†å®Œæ•´çš„æµ‹è¯•å’ŒéªŒè¯æµç¨‹

### æœªæ¥å·¥ä½œ
1. **æ€§èƒ½ä¼˜åŒ–**: è¿›ä¸€æ­¥ä¼˜åŒ–æ¨ç†é€Ÿåº¦ï¼Œç¼©å°ä¸PyTorchç‰ˆæœ¬çš„å·®è·
2. **åŠŸèƒ½æ‰©å±•**: æ”¯æŒæ›´å¤šçš„éª¨å¹²ç½‘ç»œå’Œæ•°æ®é›†
3. **éƒ¨ç½²ä¼˜åŒ–**: ä¼˜åŒ–æ¨¡å‹éƒ¨ç½²å’Œæ¨ç†æµç¨‹
4. **æ–‡æ¡£å®Œå–„**: æŒç»­å®Œå–„æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

---

**é¡¹ç›®åœ°å€**: `/home/kyc/project/RT-DETR`
**è”ç³»æ–¹å¼**: å¦‚æœ‰é—®é¢˜è¯·æäº¤Issueæˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…
**è®¸å¯è¯**: æœ¬é¡¹ç›®éµå¾ªåŸRT-DETRé¡¹ç›®çš„è®¸å¯è¯

### 10.2 å¯¹æ¯”æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜ |
|------|------|
| **è®­ç»ƒæ—¶é—´** | å®ŒæˆæŒ‡å®šè½®æ•°è®­ç»ƒæ‰€éœ€æ—¶é—´ |
| **å†…å­˜ä½¿ç”¨** | è®­ç»ƒè¿‡ç¨‹ä¸­çš„å³°å€¼å†…å­˜å ç”¨ |
| **æ¨ç†é€Ÿåº¦** | å•å¼ å›¾ç‰‡æ¨ç†æ‰€éœ€æ—¶é—´ |
| **æœ€ç»ˆæŸå¤±** | è®­ç»ƒç»“æŸæ—¶çš„å¹³å‡æŸå¤±å€¼ |
| **å‡†ç¡®ç‡** | åœ¨éªŒè¯é›†ä¸Šçš„æ£€æµ‹å‡†ç¡®ç‡ |

### 10.3 å¯¹æ¯”ç»“æœ

è¯¦ç»†çš„æ€§èƒ½å¯¹æ¯”ç»“æœä¿å­˜åœ¨ `benchmark_results/` ç›®å½•ä¸­ï¼ŒåŒ…æ‹¬ï¼š
- JSON æ ¼å¼çš„è¯¦ç»†æ•°æ®
- Markdown æ ¼å¼çš„å¯¹æ¯”æŠ¥å‘Š
- PNG æ ¼å¼çš„å¯¹æ¯”å›¾è¡¨

## 11. é¡¹ç›®ç»“æ„

```
RT-DETR-Jittor/
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–åŒ…
â”œâ”€â”€ setup.py                     # å®‰è£…è„šæœ¬
â”œâ”€â”€ prepare_data.py              # æ•°æ®å‡†å¤‡è„šæœ¬
â”œâ”€â”€ experiment_log.py            # å®éªŒè®°å½•è„šæœ¬
â”œâ”€â”€ benchmark.py                 # æ€§èƒ½å¯¹æ¯”è„šæœ¬
â”œâ”€â”€ PROJECT_SUMMARY.md           # é¡¹ç›®æ€»ç»“æ–‡æ¡£
â”œâ”€â”€ command                      # å¸¸ç”¨å‘½ä»¤è®°å½•
â”œâ”€â”€ project_structure.txt        # é¡¹ç›®ç»“æ„è®°å½•
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ coco/
â”‚       â”œâ”€â”€ annotations/
â”‚       â”‚   â”œâ”€â”€ instances_train2017.json
â”‚       â”‚   â””â”€â”€ instances_val2017.json
â”‚       â”œâ”€â”€ train2017/
â”‚       â””â”€â”€ val2017/
â”œâ”€â”€ checkpoints/                # æ¨¡å‹æ£€æŸ¥ç‚¹ç›®å½•
â”œâ”€â”€ experiments/                # å®éªŒè®°å½•ç›®å½•
â”œâ”€â”€ benchmark_results/           # æ€§èƒ½å¯¹æ¯”ç»“æœç›®å½•
â”œâ”€â”€ model.py                    # RT-DETRæ¨¡å‹å®ç°
â”œâ”€â”€ dataset.py                  # COCOæ•°æ®é›†åŠ è½½
â”œâ”€â”€ loss.py                     # DETRæŸå¤±å‡½æ•°
â”œâ”€â”€ train.py                    # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ test.py                     # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ vis.py                      # å¯è§†åŒ–è„šæœ¬
â”œâ”€â”€ loss_plot.py                # æŸå¤±æ›²çº¿ç»˜åˆ¶
â”œâ”€â”€ find_good_image.py          # æŸ¥æ‰¾æµ‹è¯•å›¾ç‰‡
â”œâ”€â”€ demo.py                     # æ¼”ç¤ºè„šæœ¬
â”œâ”€â”€ .gitignore                  # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ loss_curve.png              # æŸå¤±æ›²çº¿å›¾
â”œâ”€â”€ loss_curve.npy              # æŸå¤±æ•°æ®
â”œâ”€â”€ test.png                    # æµ‹è¯•å›¾ç‰‡
â”œâ”€â”€ test_image.jpg              # æµ‹è¯•å›¾ç‰‡
â”œâ”€â”€ 000000000139.jpg            # COCOæ•°æ®é›†å›¾ç‰‡
â”œâ”€â”€ 000000435081.jpg            # COCOæ•°æ®é›†å›¾ç‰‡
â”œâ”€â”€ vis_result.jpg              # å¯è§†åŒ–ç»“æœ
â””â”€â”€ vis_result_no_detection.jpg # æ— æ£€æµ‹ç»“æœå›¾
```

## å®éªŒæ€»ç»“

### ä¸»è¦æˆæœ ğŸ¯

1. **æˆåŠŸå®ç°**: å®Œæˆäº†RT-DETRçš„Jittorç‰ˆæœ¬å®ç°ï¼ŒåŒ…å«å®Œæ•´çš„è®­ç»ƒå’Œæ¨ç†æµç¨‹
2. **çœŸå®éªŒè¯**: åŸºäº50å¼ COCOå›¾åƒè¿›è¡Œäº†50è½®å¾®è°ƒè®­ç»ƒï¼ŒéªŒè¯äº†ä¸¤ä¸ªç‰ˆæœ¬çš„åŠŸèƒ½å¯¹é½
3. **æ€§èƒ½å¯¹æ¯”**: è¯¦ç»†å¯¹æ¯”äº†Jittorå’ŒPyTorchç‰ˆæœ¬çš„è®­ç»ƒæ€§èƒ½å’Œæ”¶æ•›æ•ˆæœ
4. **é¢„è®­ç»ƒæ”¯æŒ**: æˆåŠŸé›†æˆäº†é¢„è®­ç»ƒæƒé‡ï¼Œæå‡äº†å¾®è°ƒæ•ˆæœ

### å…³é”®å‘ç° ğŸ“Š

#### è®­ç»ƒæ€§èƒ½
- **PyTorchç‰ˆæœ¬æ›´å¿«**: è®­ç»ƒé€Ÿåº¦å¿«120.8%ï¼Œæ¯è½®ç”¨æ—¶3.8ç§’ vs 8.5ç§’
- **æ”¶æ•›æ•ˆæœæ›´å¥½**: PyTorchæœ€ç»ˆæŸå¤±0.7783ï¼ŒJittoræœ€ç»ˆæŸå¤±1.9466
- **æ”¶æ•›é€Ÿåº¦ç›¸è¿‘**: ä¸¤ä¸ªç‰ˆæœ¬çš„æ”¶æ•›é€Ÿåº¦å·®å¼‚ä»…1.1%

#### æ¨¡å‹æ¶æ„å·®å¼‚ âš ï¸
- **å‚æ•°é‡ä¸åŒ**: Jittor 31.1Må‚æ•° vs PyTorch 25.5Må‚æ•°ï¼ˆ+22.0%ï¼‰
- **æ¶æ„å·®å¼‚åŸå› **:
  - Jittorç‰ˆæœ¬: ä½¿ç”¨å®Œæ•´RT-DETRæ¶æ„ï¼ˆ300 queriesï¼Œ6å±‚è§£ç å™¨ï¼‰
  - PyTorchç‰ˆæœ¬: ä½¿ç”¨ç®€åŒ–æ¶æ„ï¼ˆ100 queriesï¼Œå•å±‚è§£ç å™¨ï¼‰
  - è¿™å¯¼è‡´äº†ä¸å…¬å¹³çš„å¯¹æ¯”ï¼Œéœ€è¦ç»Ÿä¸€æ¶æ„

#### è¯„ä¼°å±€é™æ€§ âš ï¸
- **ç¼ºå°‘æµ‹è¯•é›†è¯„ä¼°**: å½“å‰åªæœ‰è®­ç»ƒæŸå¤±ï¼Œæ²¡æœ‰mAPç­‰æ£€æµ‹æŒ‡æ ‡
- **æ— æ¨ç†æ€§èƒ½æµ‹è¯•**: ç¼ºå°‘å®é™…æ£€æµ‹æ•ˆæœå’Œæ¨ç†é€Ÿåº¦å¯¹æ¯”
- **æ¨¡å‹æ¶æ„ä¸ä¸€è‡´**: ä¸¤ä¸ªç‰ˆæœ¬ä½¿ç”¨äº†ä¸åŒå¤æ‚åº¦çš„æ¨¡å‹
- **æ•°æ®é›†è§„æ¨¡å°**: ä»…50å¼ å›¾åƒï¼Œç»“æœå¯èƒ½ä¸å¤Ÿç¨³å®š

#### å®ç”¨æ€§éªŒè¯
- **å¾®è°ƒæ–¹æ¡ˆæœ‰æ•ˆ**: åœ¨æœ‰é™ç®—åŠ›ä¸‹ï¼Œé¢„è®­ç»ƒæƒé‡å¾®è°ƒè¯æ˜å¯è¡Œ
- **æ¡†æ¶å…¼å®¹æ€§**: ä¸¤ä¸ªç‰ˆæœ¬éƒ½èƒ½æˆåŠŸè®­ç»ƒå¹¶æ”¶æ•›
- **éœ€è¦æ”¹è¿›**: éœ€è¦ç»Ÿä¸€æ¨¡å‹æ¶æ„å’Œæ·»åŠ å®Œæ•´è¯„ä¼°

### æŠ€æœ¯äº®ç‚¹ âœ¨

1. **æƒé‡è½¬æ¢**: æˆåŠŸå®ç°äº†PyTorché¢„è®­ç»ƒæƒé‡åˆ°Jittorçš„è½¬æ¢
2. **APIå¯¹é½**: Jittorç‰ˆæœ¬çš„APIæ¥å£ä¸PyTorchç‰ˆæœ¬é«˜åº¦ä¸€è‡´
3. **ä¼˜åŒ–å™¨é€‚é…**: æ­£ç¡®ä½¿ç”¨äº†Jittorçš„`optimizer.step(loss)`æ¥å£
4. **æ¢¯åº¦ä¼ æ’­**: è§£å†³äº†å¤æ‚Transformerç»“æ„çš„æ¢¯åº¦ä¼ æ’­é—®é¢˜

### åº”ç”¨å»ºè®® ğŸ’¡

#### é€‰æ‹©Jittorç‰ˆæœ¬çš„åœºæ™¯
- éœ€è¦æ›´é«˜å‚æ•°æ•ˆç‡çš„åœºæ™¯
- å¯¹è®­ç»ƒæ—¶é—´è¦æ±‚ä¸ä¸¥æ ¼çš„ç ”ç©¶é¡¹ç›®
- å¸Œæœ›ä½¿ç”¨å›½äº§æ·±åº¦å­¦ä¹ æ¡†æ¶çš„é¡¹ç›®

#### é€‰æ‹©PyTorchç‰ˆæœ¬çš„åœºæ™¯
- å¯¹è®­ç»ƒé€Ÿåº¦æœ‰ä¸¥æ ¼è¦æ±‚çš„ç”Ÿäº§ç¯å¢ƒ
- éœ€è¦å¿«é€Ÿæ”¶æ•›çš„å®éªŒåœºæ™¯
- å·²æœ‰PyTorchç”Ÿæ€ç³»ç»Ÿçš„é¡¹ç›®

### æ”¹è¿›å»ºè®® ï¿½

#### ç«‹å³éœ€è¦æ”¹è¿›çš„é—®é¢˜
1. **ç»Ÿä¸€æ¨¡å‹æ¶æ„**:
   - è®©PyTorchç‰ˆæœ¬ä¹Ÿä½¿ç”¨å®Œæ•´çš„RT-DETRæ¶æ„
   - ç¡®ä¿ä¸¤ä¸ªç‰ˆæœ¬å‚æ•°é‡å®Œå…¨ä¸€è‡´
   - ä½¿ç”¨ç›¸åŒçš„è¶…å‚æ•°é…ç½®

2. **æ·»åŠ å®Œæ•´è¯„ä¼°**:
   - å®ç°COCO mAP@0.5å’ŒmAP@0.5:0.95è®¡ç®—
   - æ·»åŠ æ¨ç†é€Ÿåº¦åŸºå‡†æµ‹è¯•
   - åˆ›å»ºæ£€æµ‹ç»“æœå¯è§†åŒ–å¯¹æ¯”

3. **æ‰©å±•å®éªŒè§„æ¨¡**:
   - ä½¿ç”¨æ›´å¤§çš„æ•°æ®é›†å­é›†ï¼ˆå¦‚500å¼ å›¾ç‰‡ï¼‰
   - è¿›è¡Œæ›´å¤šè½®æ¬¡çš„è®­ç»ƒéªŒè¯
   - æµ‹è¯•ä¸åŒçš„å­¦ä¹ ç‡å’Œä¼˜åŒ–å™¨

#### è¯„ä¼°è„šæœ¬ä½¿ç”¨
```bash
# è¿è¡Œæ¨¡å‹è¯„ä¼°ï¼ˆå½“å‰ç‰ˆæœ¬æœ‰é™åˆ¶ï¼‰
conda activate jt
python evaluation_script.py

# æŸ¥çœ‹è¯„ä¼°ç»“æœ
cat results/comparison/evaluation_results.json
```

### æœªæ¥å·¥ä½œ ğŸš€

1. **æ¶æ„å¯¹é½**: å®ç°å®Œå…¨ä¸€è‡´çš„æ¨¡å‹æ¶æ„
2. **å®Œæ•´è¯„ä¼°**: æ·»åŠ COCOæ ‡å‡†è¯„ä¼°æŒ‡æ ‡
3. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–Jittorç‰ˆæœ¬çš„è®­ç»ƒå’Œæ¨ç†é€Ÿåº¦
4. **æ‰©å±•å®éªŒ**: åœ¨æ›´å¤§æ•°æ®é›†ä¸ŠéªŒè¯ç»“æœ

---

**é¡¹ç›®åœ°å€**: `/home/kyc/project/RT-DETR`
**å®éªŒæ•°æ®**: è¯¦è§ `./results/comparison/detailed_comparison.json`
**è®­ç»ƒæ¨¡å‹**:
- Jittorç‰ˆæœ¬: `./results/jittor_finetune/rtdetr_jittor_finetune_50img_50epoch.pkl`
- PyTorchç‰ˆæœ¬: `./results/pytorch_finetune/rtdetr_pytorch_finetune_50img_50epoch.pth`

**è®¸å¯è¯**: æœ¬é¡¹ç›®éµå¾ªåŸRT-DETRé¡¹ç›®çš„è®¸å¯è¯

## 12. å¸¸è§é—®é¢˜

### 12.1 å®‰è£…é—®é¢˜

**Q: Jittor å®‰è£…å¤±è´¥**
A: è¯·ç¡®ä¿ Python ç‰ˆæœ¬ä¸º 3.7-3.9ï¼Œå¹¶å‚è€ƒå®˜æ–¹å®‰è£…æ–‡æ¡£ã€‚

**Q: CUDA ç‰ˆæœ¬ä¸åŒ¹é…**
A: è¯·æ ¹æ®æ‚¨çš„ CUDA ç‰ˆæœ¬é€‰æ‹©å¯¹åº”çš„ Jittor å®‰è£…åŒ…ã€‚

### 12.2 è®­ç»ƒé—®é¢˜

**Q: æ˜¾å­˜ä¸è¶³**
A: å¯ä»¥å‡å° `batch_size` æˆ–ä½¿ç”¨ `subset_size` å‚æ•°å‡å°‘æ•°æ®é‡ã€‚

**Q: è®­ç»ƒé€Ÿåº¦æ…¢**
A: å¯ä»¥å¯ç”¨å¤šè¿›ç¨‹æ•°æ®åŠ è½½ï¼Œæˆ–ä½¿ç”¨ GPU è®­ç»ƒã€‚

### 12.3 æ¨ç†é—®é¢˜

**Q: æ£€æµ‹ç»“æœä¸ºç©º**
A: å¯ä»¥é™ä½ `conf_threshold` å‚æ•°ï¼Œæˆ–æ£€æŸ¥æ¨¡å‹æƒé‡æ–‡ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½ã€‚

## 13. è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ï¼

## 14. è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## 15. è‡´è°¢

- [Jittor å›¢é˜Ÿ](https://github.com/Jittor/jittor) æä¾›çš„æ·±åº¦å­¦ä¹ æ¡†æ¶
- [RT-DETR è®ºæ–‡ä½œè€…](https://arxiv.org/abs/2304.08069) æä¾›çš„åŸå§‹æ¨¡å‹è®¾è®¡
- [COCO æ•°æ®é›†](https://cocodataset.org/) æä¾›çš„æ•°æ®é›†

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’ŒéªŒè¯ã€‚